<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <title>DataTables Editor - AddressesWithItems</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/s/dt/jqc-1.12.0,moment-2.11.2,dt-1.10.11,b-1.1.2,se-1.1.2/datatables.min.css">
    <link rel="stylesheet" type="text/css" href="css/generator-base.css">
    <link rel="stylesheet" type="text/css" href="css/editor.dataTables.min.css">
    <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/s/dt/jqc-1.12.0,moment-2.11.2,dt-1.10.11,b-1.1.2,se-1.1.2/datatables.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/dataTables.editor.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/table.AddressesWithItems.js"></script>
</head>
<body class="dataTables">
    <div class="container">
        <h1>
            DataTables Editor <span>AddressesWithItems</span>
        </h1>

        <table cellpadding="0" cellspacing="0" border="0" class="display" id="AddressesWithItems" width="100%">
            <thead>
                <tr>
                    <th>First name</th>
                    <th>Last name</th>
                    <th>Item Being Dropped Off</th>
                    <th>Street</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Zip Code</th>
                    <th>Sorting Id</th>
                </tr>
            </thead>
        </table>
        <div class="container col-xs-12 col-md-offset-2 col-md-8 col-lg-offset-2 col-lg-10">
            <a href="javascript:getUrlAndCallback(urlGoogMapsUrl,funDatCbackTho);"><img src="images/usaMapv2.png" class="col-xs-12 col-md-8 col-lg-8" /></a>
        </div>
        <div class="col-md-12" id="map" style="display:none"></div>

        <script>
            var funDatCbackTho = function () { alert('I GOT CALLED BACK YO') };
            var urlGoogMapsUrl = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCzyiqBO_5XdhIyozK30VcFyDKZiUD_2nw';
            function calculateRoute() {
                var table = $('#AddressesWithItems').DataTable();
                var data = table.rows().data();
                //console.log(data);
                for (var i = 0; i < data.length; i++) {
                    var objCurrentRow = data[i];
                    var strCurrentAddress = objCurrentRow.street + "," + objCurrentRow.city + "," + objCurrentRow.state + "," + objCurrentRow.zip_code;
                    strCurrentAddress = strCurrentAddress.replace(/\s/g, '+');
                    console.log(strCurrentAddress);

                };

            };



            function initMap() {
                var markerArray = [];
                // Instantiate a directions service.
                var directionsService = new google.maps.DirectionsService;
                // Create a map and center it on Manhattan.
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 13,
                    center: { lat: 40.771, lng: -73.974 }
                });
                // Create a renderer for directions and bind it to the map.
                var directionsDisplay = new google.maps.DirectionsRenderer({ map: map });
                // Instantiate an info window to hold step text.
                var stepDisplay = new google.maps.InfoWindow;
                // Display the route between the initial start and end selections.
                calculateAndDisplayRoute(
                    directionsDisplay, directionsService, markerArray, stepDisplay, map);
                // Listen to change events from the start and end lists.
                var onChangeHandler = function () {
                    calculateAndDisplayRoute(
                        directionsDisplay, directionsService, markerArray, stepDisplay, map);
                };
                //document.getElementById('start').addEventListener('change', onChangeHandler);
                //document.getElementById('end').addEventListener('change', onChangeHandler);
            }





        </script>
        <script>
            function calculateAndDisplayRoute(directionsDisplay, directionsService,
           markerArray, stepDisplay, map, originObject, destinationObject) {
                // First, remove any existing markers from the map.
                for (var i = 0; i < markerArray.length; i++) {
                    markerArray[i].setMap(null);
                }
                // Retrieve the start and end locations and create a DirectionsRequest using
                // WALKING directions.
                directionsService.route({
                    origin: originObject,//document.getElementById('start').value,// have my code populate the routes here.
                    destination: destinationObject,//document.getElementById('end').value,
                    travelMode: google.maps.TravelMode.DRIVING
                }, function (response, status) {
                    // Route the directions and pass the response to a function to create
                    // markers for each step.
                    if (status === google.maps.DirectionsStatus.OK) {
                        document.getElementById('warnings-panel').innerHTML =
                            '<b>' + response.routes[0].warnings + '</b>';
                        directionsDisplay.setDirections(response);
                        showSteps(response, markerArray, stepDisplay, map);
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });
            }

            function showSteps(directionResult, markerArray, stepDisplay, map) {
                // For each step, place a marker, and add the text to the marker's infowindow.
                // Also attach the marker to an array so we can keep track of it and remove it
                // when calculating new routes.
                var myRoute = directionResult.routes[0].legs[0];
                for (var i = 0; i < myRoute.steps.length; i++) {
                    var marker = markerArray[i] = markerArray[i] || new google.maps.Marker;
                    marker.setMap(map);
                    marker.setPosition(myRoute.steps[i].start_location);
                    attachInstructionText(
                        stepDisplay, marker, myRoute.steps[i].instructions, map);
                }
            }

            function attachInstructionText(stepDisplay, marker, text, map) {
                google.maps.event.addListener(marker, 'click', function () {
                    // Open an info window when the marker is clicked on, containing the text
                    // of the step.
                    stepDisplay.setContent(text);
                    stepDisplay.open(map, marker);
                });
            };


            function getUrlAndCallback(url, callBack) {
                //get script working much better than just standard $.get
                $.getScript(url, function (data) { }).done(callBack);

            };



        </script>

        <!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzyiqBO_5XdhIyozK30VcFyDKZiUD_2nw&callback=initMap"></script>-->


    </div>
</body>
</html>
